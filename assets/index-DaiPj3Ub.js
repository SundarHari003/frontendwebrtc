import{r as i,j as e,M as pr,F as br,a as jr,b as vr,c as yr,d as wr,P as Je,e as Nr,f as Cr,g as Sr,l as kr,V as c,I as Tr,h as $r,i as Rr,k as Z,C as ee,m as Ir,H as Er,n as Or,o as Pr,p as Ar,q as Mr,s as zr,t as Dr,O as Vr,u as Lr}from"./vendor-x6EQhDiv.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))o(g);new MutationObserver(g=>{for(const h of g)if(h.type==="childList")for(const N of h.addedNodes)N.tagName==="LINK"&&N.rel==="modulepreload"&&o(N)}).observe(document,{childList:!0,subtree:!0});function y(g){const h={};return g.integrity&&(h.integrity=g.integrity),g.referrerPolicy&&(h.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?h.credentials="include":g.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function o(g){if(g.ep)return;g.ep=!0;const h=y(g);fetch(g.href,h)}})();const z=({stream:m,muted:u,className:y=""})=>{const o=i.useRef(null);return i.useEffect(()=>(o.current&&m&&(o.current.srcObject=m),()=>{o.current&&(o.current.srcObject=null)}),[m]),e.jsx("video",{ref:o,autoPlay:!0,playsInline:!0,muted:u,className:y,onLoadedMetadata:()=>o.current.play()})},Fr=({isMuted:m,videoUrl:u,isVideoOff:y,isScreenSharing:o,onToggleAudio:g,onToggleVideo:h,onToggleScreenShare:N,onLeaveRoom:x,onToggleChat:J,chatOpen:R,someoneshare:v,setVideoUrl:f,peerId:D,onToggleparticipants:I,showparticipants:re,onTogglehandraise:H,handraiseoption:Y})=>e.jsxs("div",{className:"p-3 relative",children:[u&&e.jsx("div",{className:"absolute left-2 bottom-2 p-2 group bg-gray-100 backdrop-blur-md rounded-full  cursor-pointer overflow-hidden transition-all duration-300 hover:shadow-lg hover:shadow-blue-300/30 border border-gray-300",children:e.jsxs("a",{href:u,download:"page-recording.webm",className:"flex items-center ",onClick:()=>{f(null)},children:[e.jsx(pr,{className:"size-6 text-blue-500"}),e.jsx("button",{className:"w-0 opacity-0 group-hover:w-auto group-hover:opacity-100 group-hover:px-2 transition-all duration-300 ease-in-out text-blue-500 font-semibold text-sm",children:"Download"})]})}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsx("button",{onClick:g,className:`p-3 rounded-full transition-all ${m?"bg-red-400 text-white shadow-lg shadow-red-400/30":"bg-gray-200 text-gray-700 hover:bg-blue-200 hover:text-gray-900"}`,title:m?"Unmute":"Mute",children:m?e.jsx(br,{className:"h-5 w-5"}):e.jsx(jr,{className:"h-5 w-5"})}),e.jsx("button",{onClick:h,className:`p-3 rounded-full transition-all ${y?"bg-red-400 text-white shadow-lg shadow-red-400/30":"bg-gray-200 text-gray-700 hover:bg-blue-200 hover:text-gray-900"}`,title:y?"Turn on camera":"Turn off camera",children:y?e.jsx(vr,{className:"h-5 w-5"}):e.jsx(yr,{className:"h-5 w-5"})}),e.jsx("button",{onClick:N,disabled:v&&D!==(v==null?void 0:v.id),className:`${v&&D!==(v==null?void 0:v.id)?"opacity-50 cursor-not-allowed":""} p-3 rounded-full transition-all ${o?"bg-green-400 text-white shadow-lg shadow-green-400/30":"bg-gray-200 text-gray-700 hover:bg-blue-200 hover:text-gray-900"}`,title:o?"Stop sharing":"Share screen",children:e.jsx(wr,{className:"h-5 w-5"})}),e.jsx("button",{onClick:H,className:`p-3 rounded-full transition-all ${Y?"bg-yellow-500 text-white shadow-lg shadow-yellow-500/30":"bg-gray-200 text-gray-700 hover:bg-yellow-200 hover:text-gray-900"}`,title:"hand raise",children:e.jsx(Je,{className:"h-5 w-5"})}),e.jsx("button",{onClick:I,className:`p-3 rounded-full transition-all ${re?"bg-purple-500 text-white shadow-lg shadow-purple-500/30":"bg-gray-200 text-gray-700 hover:bg-purple-200 hover:text-gray-900"}`,title:re?"Hide chat":"Show chat",children:e.jsx(Nr,{className:"h-5 w-5"})}),e.jsx("button",{onClick:J,className:`p-3 rounded-full transition-all ${R?"bg-blue-500 text-white shadow-lg shadow-blue-500/30":"bg-gray-200 text-gray-700 hover:bg-blue-200 hover:text-gray-900"}`,title:R?"Hide Participants":"Show Participants",children:e.jsx(Cr,{className:"h-5 w-5"})}),e.jsx("button",{onClick:x,className:"p-3 rounded-full bg-red-400 text-white shadow-lg shadow-red-400/30 hover:bg-red-500 transition-all",title:"Leave room",children:e.jsx(Sr,{className:"h-5 w-5"})})]})]}),Ur=({roomId:m,name:u,isCreating:y})=>{var Me,ze,De,Ve,Le,Fe,Ue,Be,qe;const[o,g]=i.useState(null),[h,N]=i.useState(null),[x,J]=i.useState(null),[R,v]=i.useState(null),[f,D]=i.useState(null),[I,re]=i.useState(null),[H,Y]=i.useState([]),[G,ue]=i.useState([]),[B,te]=i.useState({}),[se,pe]=i.useState(!1),[ae,He]=i.useState(!1),[p,M]=i.useState({audio:!0,video:!0,screen:!1}),[Ye,V]=i.useState(!0),[be,k]=i.useState(null),[T,je]=i.useState(null),[$,A]=i.useState([]),[oe,ve]=i.useState([]),[L,Ge]=i.useState(y),[me,ye]=i.useState(y),[xe,We]=i.useState([]),[ne,we]=i.useState(""),[qr,Ke]=i.useState(null),[Ne,Ce]=i.useState(new Set),[Se,j]=i.useState("initializing"),[W,ge]=i.useState(!0),[O,_e]=i.useState(1),K=i.useRef(),ie=i.useRef(),[Qe,ke]=i.useState(!1),[le,Te]=i.useState(!1),ce=i.useRef(null),[Xe,_]=i.useState(0),[$e,de]=i.useState(!1),[Ze,Re]=i.useState(null),P=i.useRef(null),he=i.useRef([]);function er(r,t){let s;return(...a)=>{clearTimeout(s),s=setTimeout(()=>r(...a),t)}}const rr=r=>{const t=Math.floor(r/3600).toString().padStart(2,"0"),s=Math.floor(r%3600/60).toString().padStart(2,"0"),a=(r%60).toString().padStart(2,"0");return`${t} : ${s} : ${a}`},tr=()=>{_(0),ce.current=setInterval(()=>{_(r=>r+1)},1e3)},sr=()=>{ce.current&&(clearInterval(ce.current),ce.current=null)},ar=async()=>{var r;try{const t=await navigator.mediaDevices.getDisplayMedia({video:{displaySurface:"tab"},audio:!0,preferCurrentTab:!0});(r=P.current)!=null&&r.stream&&P.current.stream.getTracks().forEach(s=>s.stop()),P.current=new MediaRecorder(t,{mimeType:"video/webm"}),t.getVideoTracks()[0].onended=()=>{var s;((s=P.current)==null?void 0:s.state)!=="inactive"&&P.current.stop(),_(0),de(!1)},P.current.ondataavailable=s=>{s.data.size>0&&he.current.push(s.data)},P.current.onstop=()=>{const s=new Blob(he.current,{type:"video/webm"}),a=URL.createObjectURL(s);Re(a),sr(),he.current=[],t.getTracks().forEach(n=>n.stop()),_(0),de(!1)},P.current.start(),tr(),de(!0)}catch(t){console.error("Error starting recording:",t),de(!1),_(0)}},or=()=>{P.current&&P.current.stop()},nr=()=>{navigator.clipboard.writeText(m),ke(!0),setTimeout(()=>ke(!1),2e3)},Ie=i.useCallback(async()=>{try{return await(await fetch("https://api.metered.ca/turn/credentials?apiKey=your-metered-api-key")).json()}catch(r){return console.error("Error fetching TURN credentials:",r),[{urls:"stun:stun.l.google.com:19302"}]}},[]);i.useEffect(()=>{j("connecting-socket");const r=kr("https://backendwebrtc-x442.onrender.com",{reconnectionAttempts:5,reconnectionDelay:1e3,autoConnect:!0,transports:["websocket"]});return r.on("connect",()=>{je(r.id),g(r),k(null),j("socket-connected"),c.success("Connected to server"),console.log("Socket connected, peerId:",r.id)}),r.on("disconnect",t=>{j("socket-disconnected"),k("Connection lost. Trying to reconnect..."),c.error("Disconnected from server"),console.log("Socket disconnected:",t)}),r.on("connect_error",t=>{j("socket-connection-error"),k(`Connection error: ${t.message}`),c.error(`Connection error: ${t.message}`),console.log("Socket connect error:",t.message)}),g(r),()=>{r.disconnect()}},[]),i.useEffect(()=>o?(j("initializing-device-and-media"),(async()=>{try{V(!0),y?o.emit("createRoom",{roomId:m,name:u},t=>{t.success?(A(t.users||[]),Ge(!0),ye(!0),V(!1),j("created-room"),c.success("Room created successfully")):(k(t.error),V(!1),c.error(t.error))}):o.emit("request-to-join",{roomId:m,name:u},t=>{t.success?(V(!1),j("requested-to-join"),c.success("Join request sent to admin")):(k(t.error),V(!1),c.error(t.error))}),o.on("routerCapabilities",async t=>{try{j("loading-device");const s=new Dr.Device;await s.load({routerRtpCapabilities:t}),N(s),j("device-loaded"),console.log("Device loaded with capabilities:",t);const a=await ir();console.log("Local stream obtained:",a),J(a),j("media-obtained"),ge(!1)}catch(s){j("device-or-media-error"),k(`Initialization error: ${s.message}`),ge(!1),c.error(`Initialization error: ${s.message}`),console.log("Device or media error:",s.message)}}),o.on("admitted",({roomId:t,rtpCapabilities:s})=>{ye(!0),V(!1),j("admitted"),c.success("You have been admitted to the room"),console.log("Participant admitted to room:",t),o.emit("joinRoom",{roomId:t,name:u},a=>{a.success?(A(a.users||[]),je(o.id),j("joined-room"),c.success("Joined room successfully")):(k(a.error),c.error(a.error))})}),o.on("join-request",({peerId:t,name:s})=>{L&&(ve(a=>[...a,{peerId:t,name:s}]),c(`Join request from ${s}`,{icon:"🔔"}),console.log("Join request received from:",s,"peerId:",t))}),o.on("peerJoined",({peerId:t,peerDetails:s,users:a})=>{A(a),c(`${s.name} joined the room`,{icon:"👤"}),console.log("Peer joined, updated participants:",a)}),o.on("peerClosed",({peerId:t,peerName:s})=>{A(a=>a.filter(n=>n.id!==t)),Y(a=>a.filter(n=>n.peerId!==t)),ue(a=>(a.filter(l=>l.peerId===t).forEach(l=>{l.consumer.close(),l.stream.getTracks().forEach(w=>w.stop())}),a.filter(l=>l.peerId!==t))),c(`${s} left the room`,{icon:"🚪"}),console.log("Peer closed, peerId:",s)}),o.on("producerList",t=>{Y(t),console.log("Received producer list:",t)}),o.on("newProducer",er(t=>{Y(s=>s.some(a=>a.producerId===t.producerId)?s:[...s,t]),console.log("New producer added:",t)},100)),o.on("peer-media-toggle",({peerId:t,type:s,enabled:a,peerName:n})=>{A(l=>l.map(w=>w.id===t?{...w,[`is${s.charAt(0).toUpperCase()+s.slice(1)}On`]:a}:w)),t!==o.id&&c(`${n} ${a?"enabled":"disabled"} ${s}`,{icon:a?"✅":"❌"}),console.log(`Peer ${t} toggled ${s} to ${a}`)}),o.on("screenshare-toggle",({peerId:t,enabled:s,peerName:a})=>{A(n=>n.map(l=>l.id===t?{...l,sharingScreen:s}:l)),t!==o.id&&a&&c(`${a} ${s?"started":"stopped"} screen sharing`,{icon:s?"🖥️":"🛑"}),console.log(`Peer ${t} toggled screen sharing to ${s}`)}),o.on("handraise-toggle",({peerId:t,enabled:s,peerName:a})=>{A(n=>n.map(l=>l.id===t?{...l,handRaise:s}:l)),t!==o.id&&a&&s&&c(`${a} was hand raised`,{icon:"✋"})}),o.on("new-message",t=>{We(s=>[...s,t]),t.senderId!==o.id&&c(`${t.senderName}: ${t.message}`,{icon:"💬"}),console.log("New message received:",t)}),o.on("participants-updated",({users:t,joiningPeer:s})=>{console.log("Participants updated:",t),A(t),s&&s.peerId!==o.id&&c.success(`${s.name} joined the room`,{icon:"👤"})}),o.on("peerPropertiesUpdated",({peerId:t,property:s,value:a})=>{A(n=>n.map(l=>l.id===t?{...l,[s]:a}:l)),console.log(`Peer ${t} updated property ${s} to ${a}`)}),o.on("consumerClosed",({consumerId:t})=>{ue(s=>{const a=s.find(n=>n.consumer.id===t);return a?(a.consumer.close(),a.stream.getTracks().forEach(n=>n.stop()),s.filter(n=>n.consumer.id!==t)):s}),console.log("Consumer closed, consumerId:",t)})}catch(t){j("initialization-error"),k(`Initialization error: ${t.message}`),V(!1),c.error(`Initialization error: ${t.message}`),console.log("Initialization error:",t.message)}})(),()=>{o.off("routerCapabilities"),o.off("admitted"),o.off("join-request"),o.off("peerJoined"),o.off("peerClosed"),o.off("producerList"),o.off("newProducer"),o.off("peer-media-toggle"),o.off("screenshare-toggle"),o.off("handraise-toggle"),o.off("new-message"),o.off("participants-updated"),o.off("peerPropertiesUpdated"),o.off("consumerClosed")}):void 0,[o,m,u,y,L]);const ir=i.useCallback(async()=>{try{return await navigator.mediaDevices.getUserMedia({audio:!0,video:{width:{ideal:1920,min:1280},height:{ideal:1080,min:720},aspectRatio:1.7777777777777777,frameRate:{ideal:60,min:30},facingMode:"user",advanced:[{zoom:1,brightness:100,sharpness:100,contrast:100,saturation:100,focusMode:"continuous"}]}})}catch(r){let t="Failed to access media devices";throw r.name==="NotAllowedError"?t="Please allow camera and microphone access":r.name==="NotFoundError"?t="No media devices found":r.name==="OverconstrainedError"&&(t="Cannot satisfy requested media constraints"),k(t),ge(!1),c.error(t),console.log("Get media error:",t),r}},[]);i.useEffect(()=>!h||!o||!x||!me?void 0:((async()=>{try{j("creating-transports");const t=await Ie(),s=await Ee("send",t);D(s),j("send-transport-created");const a=await Ee("recv",t);re(a),j("recv-transport-created"),j("initialization-complete"),console.log("Transports created successfully")}catch(t){j("transport-creation-error"),k(`Error creating transports: ${t.message}`),c.error(`Error creating transports: ${t.message}`),console.log("Transport creation error:",t.message)}})(),()=>{f&&f.close(),I&&I.close()}),[h,o,x,me,Ie]);const Ee=i.useCallback(async(r,t)=>new Promise((s,a)=>{o.emit("createWebRtcTransport",{direction:r},n=>{if(n.error){a(new Error(n.error)),c.error(`Error creating ${r} transport: ${n.error}`),console.error(`Create ${r} transport error:`,n.error);return}const l=r==="send"?h.createSendTransport({...n.params,iceServers:t}):h.createRecvTransport({...n.params,iceServers:t});l.on("connect",({dtlsParameters:w},F,U)=>{o.emit("connectTransport",{transportId:l.id,dtlsParameters:w},S=>{S.error?(U(new Error(S.error)),c.error(`Error connecting ${r} transport: ${S.error}`),console.error(`Connect ${r} transport error:`,S.error)):(console.log(`Connected ${r} transport`),F())})}),l.on("iceconnectionstatechange",()=>{console.log(`ICE connection state for ${r} transport:`,l.iceConnectionState),l.iceConnectionState==="failed"&&(k(`ICE connection failed for ${r} transport`),c.error(`ICE connection failed for ${r} transport`))}),r==="send"&&l.on("produce",({kind:w,rtpParameters:F,appData:U},S,fr)=>{o.emit("produce",{transportId:l.id,kind:w,rtpParameters:F,appData:U},X=>{X.error?(fr(new Error(X.error)),c.error(`Error producing: ${X.error}`),console.error("Produce error:",X.error)):S({id:X.producerId})})}),s(l)})}),[h,o]);i.useEffect(()=>{if(!f||!x)return;(async()=>{try{const t=x.getAudioTracks()[0];if(t){const a=await f.produce({track:t,codecOptions:{opusStereo:!0,opusDtx:!0},appData:{mediaType:"audio"}});te(n=>({...n,[a.id]:a})),console.log("Audio producer created:",a.id)}const s=x.getVideoTracks()[0];if(s){const a=await f.produce({track:s,encodings:[{maxBitrate:1e5,scaleResolutionDownBy:4},{maxBitrate:3e5,scaleResolutionDownBy:2},{maxBitrate:9e5}],codecOptions:{videoGoogleStartBitrate:1e3},appData:{mediaType:"video"}});te(n=>({...n,[a.id]:a})),console.log("Video producer created:",a.id)}}catch(t){k(`Error producing media: ${t.message}`),c.error(`Error producing media: ${t.message}`),console.log("Produce media error:",t.message)}})()},[f,x]);const Oe=i.useCallback(async(r,t=3,s=1e3)=>{for(let a=1;a<=t;a++)try{const{params:n}=await new Promise((F,U)=>{o.emit("consume",{transportId:I.id,producerId:r.producerId,rtpCapabilities:h.rtpCapabilities},S=>{S.error?(U(new Error(S.error)),console.log("Consume error:",S.error)):F(S)})}),l=await I.consume({id:n.id,producerId:n.producerId,kind:n.kind,rtpParameters:n.rtpParameters,appData:r.appData||{mediaType:n.kind}}),w=new MediaStream;return w.addTrack(l.track),console.log("Consumer created:",{id:l.id,kind:l.kind,track:l.track,trackEnabled:l.track.enabled,trackReadyState:l.track.readyState,streamTracks:w.getTracks(),streamActive:w.active,peerId:r.peerId,producerId:r.producerId}),await new Promise((F,U)=>{o.emit("resumeConsumer",{consumerId:l.id},S=>{S.error?(U(new Error(S.error)),console.log("Resume consumer error:",S.error)):(console.log("Consumer resumed:",l.id),F())})}),{consumer:l,stream:w,peerId:r.peerId,peerName:r.peerName,producerId:r.producerId,kind:n.kind,mediaType:l.appData.mediaType||n.kind}}catch(n){if(n.message.includes("Consumer already exists")&&a<t){console.log(`Retrying consumer creation for producer ${r.producerId} (attempt ${a+1})`),await new Promise(l=>setTimeout(l,s));continue}return c.error(`Error consuming producer: ${n.message}`),console.error("Create consumer error:",n.message),null}return null},[I,h,o]);i.useEffect(()=>{if(!I||!h||!o||H.length===0||!T)return;(async()=>{const t=H.filter(s=>s.peerId!==T&&!G.some(a=>a.producerId===s.producerId)&&!Ne.has(s.producerId));if(t.length!==0)try{Ce(n=>{const l=new Set(n);return t.forEach(w=>l.add(w.producerId)),l});const a=(await Promise.all(t.map(Oe))).filter(Boolean);a.length>0&&ue(n=>{const l=[...n,...a];return console.log("New consumers added:",a),l})}catch(s){k(`Error consuming media: ${s.message}`),c.error(`Error consuming media: ${s.message}`),console.error("Consume producers error:",s.message)}finally{Ce(s=>{const a=new Set(s);return t.forEach(n=>a.delete(n.producerId)),a})}})()},[H,I,h,o,G,T,Ne,Oe]),i.useEffect(()=>{if(f)return K.current=setInterval(async()=>{try{const r=await f.getStats();Ke(r||{})}catch(r){c.error("Error getting connection stats"),console.log("Get stats error:",r.message)}},5e3),()=>{K.current&&clearInterval(K.current)}},[f]);const lr=i.useCallback(()=>{if(x){const r=!p.audio;x.getAudioTracks().forEach(t=>t.enabled=r),M(t=>({...t,audio:r})),o.emit("toggle-media",{roomId:m,type:"audio",enabled:r,name:u},t=>{t.success?c.success(r?"Microphone enabled":"Microphone muted"):(c.error(t.error),console.log("Toggle audio error:",t.error))}),Object.values(B).forEach(t=>{t.appData.mediaType==="audio"&&(r?t.resume():t.pause())})}},[x,p.audio,o,m,u,B]),cr=i.useCallback(()=>{if(x){const r=!p.video;x.getVideoTracks().forEach(t=>t.enabled=r),M(t=>({...t,video:r})),o.emit("toggle-media",{roomId:m,type:"video",enabled:r,name:u},t=>{t.success?c.success(r?"Camera enabled":"Camera disabled"):(c.error(t.error),console.log("Toggle video error:",t.error))}),Object.values(B).forEach(t=>{t.appData.mediaType==="video"&&(r?t.resume():t.pause())})}},[x,p.video,o,m,u,B]),dr=i.useCallback(async()=>{try{if(p.screen){const a=R;v(null),M(n=>({...n,screen:!1})),o.emit("toggle-screenshare",{roomId:m,enabled:!1,name:u},n=>{n.success?(a&&a.getTracks().forEach(l=>l.stop()),c.success("Stopped screen sharing")):(v(a),M(l=>({...l,screen:!0})),c.error(n.error),console.log("Toggle screen share (stop) error:",n.error))});return}const r=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920},height:{ideal:1080},frameRate:{ideal:30}},audio:!0});v(r),M(a=>({...a,screen:!0}));const t=r.getVideoTracks()[0],s=await f.produce({track:t,encodings:[{maxBitrate:15e5}],codecOptions:{videoGoogleStartBitrate:1e3},appData:{mediaType:"screen"}});te(a=>({...a,[s.id]:s})),o.emit("toggle-screenshare",{roomId:m,enabled:!0,name:u},a=>{a.success?c.success("Started screen sharing"):(s.close(),r.getTracks().forEach(n=>n.stop()),v(null),M(n=>({...n,screen:!1})),te(n=>{const l={...n};return delete l[s.id],l}),c.error(a.error),console.log("Toggle screen share (start) error:",a.error))}),t.onended=()=>{s.close(),M(a=>({...a,screen:!1})),v(null),o.emit("toggle-screenshare",{roomId:m,enabled:!1,name:u},a=>{a.success?c.success("Screen sharing stopped"):(c.error(a.error),console.log("Toggle screen share (onended) error:",a.error))})}}catch(r){r.name!=="NotAllowedError"&&(c.error(`Error toggling screen share: ${r.message}`),M(t=>({...t,screen:!1})),v(null),console.log("Toggle screen share error:",r.message))}},[p.screen,R,f,o,m,u]),ur=r=>{o.emit("admit-participant",{roomId:m,peerId:r},t=>{t.success?(ve(s=>s.filter(a=>a.peerId!==r)),c.success("Participant admitted"),console.log("Participant admitted:",r)):(c.error(t.error),console.log("Admit participant error:",t.error))})},mr=async()=>{try{o.emit("toggle-handraise",{roomId:m,enabled:!ae,name:u},r=>{r.success?c.success(ae?"Hand Downed":"Hand Raised"):(c.error(r.error),console.log("Hand raise error:",r.error))}),He(!ae)}catch(r){c.error(`Error hand raise: ${r.message}`)}},xr=r=>{r.preventDefault(),ne.trim()&&o.emit("send-message",{roomId:m,message:ne},t=>{t.success?(we(""),console.log("Message sent:",ne)):(c.error(t.error),console.log("Send message error:",t.error))})},gr=i.useCallback(()=>{x&&x.getTracks().forEach(r=>r.stop()),R&&R.getTracks().forEach(r=>r.stop()),Object.values(B).forEach(r=>r.close()),G.forEach(r=>{r.consumer.close(),r.stream.getTracks().forEach(t=>t.stop())}),f&&f.close(),I&&I.close(),o&&o.disconnect(),K.current&&clearInterval(K.current),window.location.reload()},[x,R,B,G,f,I,o]);i.useEffect(()=>{ie.current&&(ie.current.scrollTop=ie.current.scrollHeight)},[xe]);const b={};G.forEach(r=>{b[r.peerId]||(b[r.peerId]={name:r.peerName,media:{}}),b[r.peerId].media[r.mediaType]=r});const d=$.find(r=>r.isAdmin),Q=$.filter(r=>!r.isAdmin&&r.id!==T),E=$.find(r=>r.id===T),fe=L?2:1,C=$.find(r=>r.sharingScreen),hr=Q.filter(r=>!r.isAdmin).length,q=Math.ceil(hr/fe),Pe=Q.slice((O-1)*fe,O*fe),Ae=r=>{_e(r)};return me?be?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-900 p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:[e.jsx("div",{className:"bg-red-600 px-4 py-3",children:e.jsx("h2",{className:"text-lg font-bold text-white",children:"Connection Error"})}),e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("svg",{className:"h-6 w-6 text-red-500",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-lg font-medium text-white",children:"Something went wrong"}),e.jsxs("div",{className:"mt-2 text-sm text-gray-300",children:[e.jsx("p",{children:be}),e.jsxs("p",{className:"mt-2 text-xs text-gray-400",children:["Debug state: ",Se]})]})]})]}),e.jsx("div",{className:"mt-6 flex justify-end space-x-3",children:e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition",children:"Refresh Page"})})]})]})}):Ye?e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-900",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsxs("p",{className:"mt-4 text-lg text-white font-medium",children:["Initializing room... (",Se,")"]}),e.jsx("p",{className:"mt-2 text-sm text-gray-400",children:"This may take a few moments..."})]})}):e.jsxs("div",{className:"relative h-screen w-full bg-gradient-to-br from-white via-gray-300 to-white overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-white/30 via-gray-100/50 to-white/30 opacity-80"}),e.jsxs("div",{className:"relative h-full w-full flex flex-col font-sans",children:[e.jsx("header",{className:"px-6 py-4 z-10 bg-white/50 backdrop-blur-md border-b border-gray-200/50",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("h1",{className:"text-2xl font-extrabold text-gray-900 tracking-tight flex items-center space-x-2",children:[e.jsx("span",{className:"text-gray-800",children:m}),e.jsx("button",{onClick:nr,title:"Copy Room ID",className:"text-blue-500 hover:text-teal-500 transition cursor-pointer",children:e.jsx(Tr,{size:18})}),Qe&&e.jsx("span",{className:"text-xs text-green-500",children:"Copied!"})]}),L&&e.jsx("span",{className:"bg-gradient-to-r from-blue-500 to-teal-500 text-xs text-white px-3 py-1 rounded-full shadow-md",children:"ADMIN"})]}),e.jsx("div",{className:"flex items-center space-x-6",children:e.jsxs("div",{className:" flex items-center space-x-2",children:[e.jsxs("div",{className:"flex relative items-center cursor-pointer space-x-2 bg-gray-200 text-gray-800 font-medium backdrop-blur-md rounded-full px-4 py-2 shadow-md",children:[$e&&e.jsx("span",{className:" bg-red-500 left-3.5 absolute animate-ping size-3 rounded-full me-2"}),e.jsx("span",{className:" bg-red-500 size-2 rounded-full me-3"}),rr(Xe)]}),e.jsx("div",{children:$e?e.jsx("div",{onClick:or,children:e.jsx($r,{className:" size-9 text-red-500 cursor-pointer backdrop-blur-md rounded-full shadow-md",title:"stop record"})}):e.jsx("div",{onClick:ar,children:e.jsx(Rr,{className:" size-9 text-blue-500 cursor-pointer backdrop-blur-md rounded-full shadow-md",title:"start record"})})})]})})]})}),e.jsxs("main",{className:"flex-1 flex overflow-hidden",children:[e.jsx("div",{className:"flex-1 p-6 overflow-y-auto",children:$.length===0?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-24 h-24 border-4 border-blue-400 border-t-transparent rounded-full animate-spin mx-auto mb-6"}),e.jsx("p",{className:"text-gray-900 text-xl font-semibold",children:"Awaiting participants..."}),e.jsx("p",{className:"text-gray-500 mt-3 text-sm",children:"Share this room ID to invite others"})]})}):$.length===1?e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsxs("div",{className:"relative w-3/4 h-full max-h-[80vh] aspect-video bg-white/50 rounded-2xl overflow-hidden shadow-md backdrop-blur-sm border border-gray-200/50",children:[E?W?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsx("div",{className:"w-20 h-20 border-4 border-blue-400 border-t-transparent rounded-full animate-spin"})}):x&&p.video?e.jsx(z,{stream:x,muted:!0,className:"w-full h-full object-cover rounded-2xl"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-28 h-28 rounded-full bg-gradient-to-br from-blue-200 to-teal-200 flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx("span",{className:"text-4xl text-gray-900 font-bold",children:((Me=E.name)==null?void 0:Me.charAt(0).toUpperCase())||"U"})}),e.jsx("p",{className:"text-gray-900 text-lg font-medium",children:E.name})]})}):null,e.jsxs("div",{className:`absolute bottom-4 left-4 bg-gray-100/70 ${!p.video||!p.audio?"pe-2":"pe-4"} ps-4 py-2 rounded-full text-gray-900 text-sm backdrop-blur-sm flex items-center space-x-2`,children:[e.jsxs("span",{children:[E==null?void 0:E.name," (You)"]}),!p.video&&e.jsx("span",{className:"p-2 text-base bg-red-400/80 text-white rounded-full",children:e.jsx(Z,{})}),!p.audio&&e.jsx("span",{className:"p-2 text-base bg-red-400/80 text-white rounded-full",children:e.jsx(ee,{})})]})]})}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-6 h-full",children:[e.jsx("div",{className:"lg:col-span-3 bg-white/50 rounded-2xl overflow-hidden border border-gray-200/50 backdrop-blur-sm shadow-md",children:e.jsx("div",{className:"relative w-full h-full max-h-[80vh] aspect-video",children:C?e.jsxs(e.Fragment,{children:[C.id===T?W?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsx("div",{className:"w-20 h-20 border-4 border-blue-400 border-t-transparent rounded-full animate-spin"})}):R?e.jsx(z,{stream:R,muted:!0,className:"w-full h-full object-contain rounded-2xl"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-28 h-28 rounded-full bg-gradient-to-br from-blue-200 to-teal-200 flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx("span",{className:"text-4xl text-gray-900 font-bold",children:((ze=C.name)==null?void 0:ze.charAt(0).toUpperCase())||"U"})}),e.jsx("p",{className:"text-gray-900 text-lg font-medium",children:C.name})]})}):(De=b[C.id])!=null&&De.media.screen?e.jsxs(e.Fragment,{children:[console.log("Rendering screen share for participant:",{peerId:C.id,stream:b[C.id].media.screen.stream,tracks:b[C.id].media.screen.stream.getTracks(),isScreenSharing:C.sharingScreen}),e.jsx(z,{stream:b[C.id].media.screen.stream,muted:!1,className:"w-full h-full object-contain rounded-2xl"})]}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-28 h-28 rounded-full bg-gradient-to-br from-blue-200 to-teal-200 flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx("span",{className:"text-4xl text-gray-900 font-bold",children:((Ve=C.name)==null?void 0:Ve.charAt(0).toUpperCase())||"U"})}),e.jsx("p",{className:"text-gray-900 text-lg font-medium",children:C.name})]})}),e.jsxs("div",{className:"absolute bottom-4 left-4 bg-gray-100/70 px-4 py-2 rounded-full text-gray-900 text-sm backdrop-blur-sm flex items-center space-x-2",children:[e.jsxs("span",{className:"truncate max-w-xs",children:[C.name," ",C.id===T?"(You)":""]}),e.jsx("span",{className:"px-2 py-1 bg-green-400/80 rounded-full text-xs",children:"Screen Sharing"})]})]}):d?e.jsxs(e.Fragment,{children:[d.id===T?W?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsx("div",{className:"w-20 h-20 border-4 border-blue-400 border-t-transparent rounded-full animate-spin"})}):x&&p.video?e.jsx(z,{stream:x,muted:!0,className:"w-full h-full object-cover rounded-2xl"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"w-28 h-28 rounded-full bg-gradient-to-br from-blue-200 to-teal-200 flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx("span",{className:"text-4xl text-gray-900 font-bold",children:((Le=d.name)==null?void 0:Le.charAt(0).toUpperCase())||"A"})})})}):(Fe=b[d.id])!=null&&Fe.media.video&&d.isVideoOn?e.jsxs(e.Fragment,{children:[console.log("Rendering video for admin participant:",{peerId:d.id,stream:b[d.id].media.video.stream,tracks:b[d.id].media.video.stream.getTracks(),isVideoOn:d.isVideoOn}),e.jsx(z,{stream:b[d.id].media.video.stream,muted:!1,className:"w-full h-full object-cover rounded-2xl"})]}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"w-28 h-28 rounded-full bg-gradient-to-br from-blue-200 to-teal-200 flex items-center justify-center mx-auto mb-4 shadow-lg",children:e.jsx("span",{className:"text-4xl text-gray-900 font-bold",children:((Ue=d.name)==null?void 0:Ue.charAt(0).toUpperCase())||"A"})})})}),e.jsxs("div",{className:`absolute bottom-4 left-4 ${d.isVideoOn?"bg-gray-100/70":"bg-gray-200"} ${!d.isVideoOn||!d.isAudioOn?"pe-2":"pe-4"} ps-4 py-2 rounded-full text-gray-900 text-sm backdrop-blur-sm flex items-center space-x-2`,children:[e.jsxs("span",{children:[d.name," ",d.id===T?"(You)":"(Admin)"]}),!d.isVideoOn&&e.jsx("span",{className:"p-2 text-base bg-red-400/80 text-white rounded-full",children:e.jsx(Z,{})}),!d.isAudioOn&&e.jsx("span",{className:"p-2 text-base bg-red-400/80 text-white rounded-full",children:e.jsx(ee,{})})]})]}):null})}),e.jsxs("div",{className:`lg:col-span-1 flex flex-col ${L?"space-y-6":"space-y-3"}`,children:[E&&!E.isAdmin&&!E.sharingScreen&&e.jsx("div",{className:"bg-white/50 rounded-2xl overflow-hidden border border-gray-200/50 backdrop-blur-sm shadow-xl",children:e.jsxs("div",{className:"relative aspect-video",children:[W?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsx("div",{className:"w-20 h-20 border-4 border-blue-400 border-t-transparent rounded-full animate-spin"})}):x&&p.video?e.jsx(z,{stream:x,muted:!0,className:"w-full h-full object-cover rounded-2xl"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-200 to-teal-200 flex items-center justify-center mx-auto mb-3 shadow-lg",children:e.jsx("span",{className:"text-3xl text-gray-900 font-bold",children:(u==null?void 0:u.charAt(0).toUpperCase())||"U"})}),e.jsx("p",{className:"text-gray-900 text-sm font-medium",children:u})]})}),e.jsxs("div",{className:`absolute bottom-3 left-3 ${p.video?"bg-gray-100/70":"bg-gray-200"} ${!p.video||!p.audio?"pe-1":"pe-2"} ps-2 py-1 rounded-full text-gray-900 text-xs backdrop-blur-sm flex items-center space-x-2`,children:[e.jsx("span",{children:"You"}),!p.video&&e.jsx("span",{className:"p-1 bg-red-400/80 text-white rounded-full text-sm",children:e.jsx(Z,{})}),!p.audio&&e.jsx("span",{className:"p-1 bg-red-400/80 text-white rounded-full text-sm",children:e.jsx(ee,{})})]})]})}),(E==null?void 0:E.sharingScreen)&&((Be=b[d.id])==null?void 0:Be.media.video)&&e.jsx("div",{className:"bg-white/50 rounded-2xl overflow-hidden border border-gray-200/50 backdrop-blur-sm shadow-xl",children:e.jsxs("div",{className:"relative aspect-video",children:[W?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsx("div",{className:"w-20 h-20 border-4 border-blue-400 border-t-transparent rounded-full animate-spin"})}):b[d.id].media.video&&d.isVideoOn?e.jsxs(e.Fragment,{children:[console.log("Rendering video for admin (screen sharing case):",{peerId:d.id,stream:b[d.id].media.video.stream,tracks:b[d.id].media.video.stream.getTracks(),isVideoOn:d.isVideoOn}),e.jsx(z,{stream:b[d.id].media.video.stream,muted:!0,className:"w-full h-full object-cover rounded-2xl"})]}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-200 to-teal-200 flex items-center justify-center mx-auto mb-3 shadow-lg",children:e.jsx("span",{className:"text-3xl text-gray-900 font-bold",children:((qe=d.name)==null?void 0:qe.charAt(0).toUpperCase())||"A"})}),e.jsx("p",{className:"text-gray-900 text-sm font-medium",children:d.name})]})}),e.jsxs("div",{className:`absolute bottom-3 left-3 bg-gray-100/70 ${!d.isVideoOn||!d.isAudioOn?"px-3":"px-4"} py-1 rounded-full text-gray-900 text-xs backdrop-blur-sm flex items-center space-x-2`,children:[e.jsx("span",{children:"Admin"}),!d.isVideoOn&&e.jsx("span",{className:"px-2 py-1 bg-red-400/80 rounded-full text-white text-xxs",children:e.jsx(Z,{})}),!d.isAudioOn&&e.jsx("span",{className:"px-2 py-1 bg-red-400/80 rounded-full text-white text-xxs",children:e.jsx(ee,{})})]})]})}),e.jsx("div",{className:"flex-1 flex flex-col space-y-6",children:e.jsxs("div",{className:"bg-white/50 backdrop-blur-xl rounded-2xl border border-gray-200/50 shadow-xl p-4",children:[e.jsxs("h3",{className:"text-gray-900 text-lg font-semibold mb-4",children:["Participants (",Q==null?void 0:Q.length,")"]}),e.jsxs("div",{className:"space-y-4",children:[Pe.map(r=>{var t,s;return e.jsx("div",{className:"bg-white/50 rounded-2xl overflow-hidden border border-gray-200/50 backdrop-blur-sm shadow-xl",children:e.jsxs("div",{className:"relative aspect-video",children:[r.sharingScreen?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gradient-to-br from-blue-100 to-teal-100 text-gray-900 text-center",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-bold",children:r.name}),e.jsx("p",{className:"text-sm mt-1",children:"is sharing their screen"})]})}):(t=b[r.id])!=null&&t.media.video&&r.isVideoOn?e.jsxs(e.Fragment,{children:[console.log("Rendering video for participant:",{peerId:r.id,stream:b[r.id].media.video.stream,tracks:b[r.id].media.video.stream.getTracks(),isVideoOn:r.isVideoOn}),e.jsx(z,{stream:b[r.id].media.video.stream,muted:!1,className:"w-full h-full object-cover rounded-2xl"})]}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100/80",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"w-20 h-20 rounded-full bg-gradient-to-br from-blue-200 to-teal-200 flex items-center justify-center mx-auto mb-3 shadow-lg",children:e.jsx("span",{className:"text-3xl text-gray-900 font-bold",children:((s=r.name)==null?void 0:s.charAt(0).toUpperCase())||"U"})})})}),e.jsxs("div",{className:`absolute bottom-3 left-3 ${r.isVideoOn?"bg-gray-100/70":"bg-gray-200"} ${r.isVideoOn&&r.isAudioOn?"pe-2":"pe-1"} ps-2 py-1 rounded-full text-gray-900 text-xs backdrop-blur-sm flex items-center space-x-2`,children:[e.jsx("span",{children:r.name}),!r.isVideoOn&&!r.sharingScreen&&e.jsx("span",{className:"p-1 bg-red-400/80 text-white rounded-full text-sm",children:e.jsx(Z,{})}),!r.isAudioOn&&e.jsx("span",{className:"p-1 bg-red-400/80 text-white rounded-full text-sm",children:e.jsx(ee,{})})]})]})},r.id)}),Pe.length===0&&e.jsx("div",{className:"flex-1 flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500 text-sm",children:"No participants on this page"})})]}),q>1&&e.jsxs("div",{className:"flex justify-between items-center space-x-3 mt-6",children:[e.jsx("button",{onClick:()=>Ae(O>1?O-1:q),className:`p-3 rounded-full bg-gray-200/50 text-gray-700 hover:bg-blue-300/50 transition-all duration-200 shadow-md ${O===1?"opacity-50 cursor-not-allowed":""}`,disabled:O===1,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z",clipRule:"evenodd"})})}),e.jsxs("span",{className:"text-gray-700 text-sm font-medium",children:[O," / ",q]}),e.jsx("button",{onClick:()=>Ae(O<q?O+1:1),className:`p-3 rounded-full bg-gray-200/50 text-gray-700 hover:bg-blue-300/50 transition-all duration-200 shadow-md ${O===q?"opacity-50 cursor-not-allowed":""}`,disabled:O===q,children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z",clipRule:"evenodd"})})})]})]})})]})]})}),e.jsxs("div",{className:`absolute z-10 right-6 ${se?"bottom-6":"-bottom-4"} w-96 bg-white/50 backdrop-blur-xl rounded-2xl border border-gray-200/50 shadow-2xl transition-all duration-500 ease-in-out ${se?"translate-y-0 opacity-100":"translate-y-full opacity-0"}`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-200/50 bg-gray-100/50 rounded-t-2xl backdrop-blur-2xl flex justify-between items-center",children:[e.jsxs("h3",{className:"text-gray-900 text-lg font-semibold flex items-center gap-x-2",children:[e.jsx(Ir,{className:"size-5"}),e.jsx("span",{className:"mb-1",children:"Chat"})]}),e.jsx("button",{onClick:()=>pe(!1),className:"text-gray-500 hover:text-gray-900 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsx("div",{ref:ie,className:"h-80 p-4 overflow-y-auto",children:xe.length===0?e.jsx("p",{className:"text-gray-500 text-center py-10",children:"No messages yet"}):xe.map((r,t)=>e.jsx("div",{className:`mb-4 ${r.senderId===T?"text-right":"text-left"}`,children:e.jsxs("div",{className:`inline-block max-w-xs px-4 py-2 rounded-xl shadow-md ${r.senderId===T?"bg-gradient-to-r from-blue-500 to-teal-500 text-white":"bg-gray-200/50 text-gray-900"}`,children:[e.jsxs("div",{className:"text-xs text-gray-600 mb-1",children:[r.senderName," ",r.senderId===T&&"(You)"]}),e.jsx("p",{className:"text-sm",children:r.message})]})},t))}),e.jsx("div",{className:"p-4 border-t border-gray-200/50",children:e.jsxs("div",{className:"flex",children:[e.jsx("input",{type:"text",value:ne,onChange:r=>we(r.target.value),className:"flex-1 bg-gray-200/50 text-gray-900 px-4 py-2 rounded-l-xl focus:outline-none focus:ring-2 focus:ring-blue-400/50 border border-gray-200/50",placeholder:"Type a message..."}),e.jsx("button",{type:"submit",onClick:xr,className:"bg-gradient-to-r from-blue-500 to-teal-500 text-white px-6 py-2 rounded-r-xl hover:from-blue-600 hover:to-teal-600 transition-all",children:"Send"})]})})]}),e.jsxs("div",{className:`absolute z-10 left-6 ${le?"bottom-6":"-bottom-4"} w-96 bg-gray-200 rounded-2xl border border-gray-200/50 shadow-2xl transition-all duration-500 ease-in-out ${le?"translate-y-0 opacity-100":"translate-y-full opacity-0"}`,children:[e.jsxs("div",{className:"p-4 border-b border-gray-200/50 bg-gray-100/50 rounded-t-2xl backdrop-blur-2xl flex justify-between items-center",children:[e.jsxs("h3",{className:"text-gray-900 text-lg font-semibold flex items-center gap-x-2",children:[e.jsx(Er,{className:"size-5"}),e.jsxs("span",{children:["Participants ",`(${$==null?void 0:$.length})`]})]}),e.jsx("button",{onClick:()=>Te(!1),className:"text-gray-500 hover:text-gray-900 transition-colors",children:e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",viewBox:"0 0 20 20",fill:"currentColor",children:e.jsx("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),e.jsx("div",{className:"max-h-80 overflow-y-auto",children:$==null?void 0:$.map((r,t)=>e.jsxs("div",{className:`flex item-center justify-between p-3 ${$.length-1===t?"border-b-0":"border-b"} border-b-gray-400`,children:[e.jsxs("div",{className:"flex items-center justify-center gap-x-1",children:[e.jsx("span",{className:"text-gray-800 font-semibold",children:r.name}),r.isAdmin&&e.jsx("span",{className:"bg-gradient-to-r from-blue-500 to-teal-500 text-xs text-white px-3 py-1 rounded-full shadow-md",children:"Admin"}),e.jsx("span",{children:r.id===o.id&&"(You)"})]}),e.jsxs("div",{className:"flex item-center justify-center gap-x-2",children:[r.sharingScreen&&e.jsx(Or,{className:"size-5.5 text-blue-600"}),r.isVideoOn?e.jsx(Pr,{className:"size-5 text-green-600"}):e.jsx(Ar,{className:"size-5 text-red-500"}),r.isAudioOn?e.jsx(Mr,{className:"size-5 text-green-600"}):e.jsx(zr,{className:"size-5 text-red-500"}),r.handRaise&&e.jsx(Je,{className:"size-5 text-yellow-500"})]})]},t))})]})]}),e.jsx(Fr,{peerId:T,videoUrl:Ze,isMuted:!p.audio,isVideoOff:!p.video,isScreenSharing:p.screen,onToggleAudio:lr,onToggleVideo:cr,onToggleScreenShare:dr,onLeaveRoom:gr,onToggleChat:()=>pe(!se),showparticipants:le,onToggleparticipants:()=>Te(!le),someoneshare:C,chatOpen:se,setVideoUrl:Re,handraiseoption:ae,onTogglehandraise:mr,className:"bg-white/50 backdrop-blur-md border-t border-gray-200/50"}),oe.length>0&&e.jsxs("div",{className:"absolute top-24 right-6 w-80 bg-white/50 backdrop-blur-xl rounded-2xl border border-gray-200/50 shadow-2xl z-50",children:[e.jsx("div",{className:"p-4 border-b border-gray-200/50",children:e.jsxs("h3",{className:"text-gray-900 text-lg font-semibold",children:["Pending Join Requests (",oe.length,")"]})}),e.jsxs("div",{className:"max-h-72 overflow-y-auto",children:[oe.map(r=>e.jsxs("div",{className:"p-4 border-b border-gray-200/50 last:border-b-0 flex justify-between items-center hover:bg-gray-100/30 transition-colors",children:[e.jsx("span",{className:"text-gray-900 text-sm font-medium",children:r.name}),L&&e.jsx("button",{onClick:()=>ur(r.peerId),className:"bg-gradient-to-r from-green-400 to-teal-400 text-white px-4 py-1.5 rounded-full text-sm hover:from-green-500 hover:to-teal-500 transition-all shadow-md",children:"Admit"})]},r.peerId)),!L&&oe.length>0&&e.jsx("div",{className:"p-4 text-gray-500 text-sm text-center",children:"Waiting for admin to admit these participants."})]})]})]})]}):e.jsx("div",{className:"flex items-center justify-center min-h-screen bg-gray-900",children:e.jsxs("div",{className:"text-center text-white",children:[e.jsx("div",{className:"w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-4 text-lg font-medium",children:"Waiting for admin approval..."})]})})};function Br(){const[m,u]=i.useState(!1),[y,o]=i.useState(""),[g,h]=i.useState(""),[N,x]=i.useState(!1),J=f=>{f.preventDefault(),y&&g&&u(!0)},R=f=>{if(f.preventDefault(),g){const D=Math.random().toString(36).substring(2,7);console.log(`Room created with ID: ${D}`),o(D),x(!0),u(!0)}},v=()=>{x(!N),o("")};return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx(Vr,{position:"top-right"}),m?e.jsx(Ur,{roomId:y,name:g,isCreating:N}):e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"bg-white p-8 rounded-lg shadow-md w-full max-w-md",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6 text-center text-indigo-600",children:N?"Create Video Conference":"Join Video Conference"}),e.jsxs("form",{onSubmit:N?R:J,children:[!N&&e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{htmlFor:"roomId",className:"block text-gray-700 mb-2",children:"Room ID"}),e.jsx("input",{type:"text",id:"roomId",value:y,onChange:f=>o(f.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter room ID",required:!0})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("label",{htmlFor:"name",className:"block text-gray-700 mb-2",children:"Your Name"}),e.jsx("input",{type:"text",id:"name",value:g,onChange:f=>h(f.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500",placeholder:"Enter your name",required:!0})]}),e.jsx("button",{type:"submit",className:"w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 transition duration-300 mb-4",children:N?"Create Room":"Join Room"}),e.jsx("button",{type:"button",onClick:v,className:"w-full bg-gray-200 text-gray-700 py-2 px-4 rounded-md hover:bg-gray-300 transition duration-300",children:N?"Switch to Join Room":"Switch to Create Room"})]})]})})]})}Lr.createRoot(document.getElementById("root")).render(e.jsx(i.StrictMode,{children:e.jsx(Br,{})}));
